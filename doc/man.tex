\documentclass[12pt]{amsart}
%\usepackage[intlimits]{amsmath}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{cite}
%\usepackage[]{natbib}
\usepackage{subfigure}
\usepackage{listings}
\usepackage{color}
%\usepackage[nomarkers,figuresonly]{endfloat}
\usepackage{geometry} % see geometry.pdf on how to lay out the page. There's lots.
\usepackage{paralist}
\usepackage{lscape}
\usepackage{caption}
\usepackage{lineno}
%\linenumbers

\usepackage{pgf}
\usepackage{tikz}
\usepackage{pgfplots}
%\usepackage{harvard}
\usetikzlibrary{shapes,arrows,chains,automata,fit}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric,intersections}

\author{Youngung Jeong}
% \address{
%   International Center for Automotive Research
%   Clemson University
% }
\email[Y. Jeong]{youngung.jeong@gmail.com}

%\usepackage{authblk}
\geometry{a4paper} % or letter or a5paper or ... etc
% \geometry{landscape} % rotated page geometry
\hypersetup{
  colorlinks,%
  citecolor=blue,%,black
  filecolor=blue,%
  linkcolor=blue,%
  urlcolor=blue
}

\doublespacing

% %% Custom colors
% \definecolor{dkgreen}{rgb}{0,0.6,0}
% \definecolor{lime}(0,255,0)
% \definecolor{gray}{rgb}{0.5,0.5,0.5}
% \definecolor{mauve}{rgb}{0.58,0,0.82}
% \definecolor{lightgray}{rgb}{0.83, 0.83, 0.83}
% \definecolor{lightergray}{rgb}{0.90, 0.90, 0.90}
% \definecolor{verylightgray}{rgb}{0.95, 0.95, 0.95}

%% not working
% \colorlet{lcfree}{Green3}
% \colorlet{lcnorm}{Blue3}
% \colorlet{lccong}{Red3}

% -------------------------------------------------
% Set up a new layer for the debugging marks, and make sure it is on
% top
% \pgfdeclarelayer{marx}
% \pgfsetlayers{main,marx}


%% custom lst styles
% \lstdefinestyle{numbers} {numbers=left, stepnumber=1, numberstyle=\tiny, numbersep=10pt}
% \lstdefinestyle{MyFrame}{backgroundcolor=\color{yellow},frame=shadowbox}

% \lstdefinestyle{Fortran} {
%   language=Fortran,
%   aboveskip=3mm,
%   belowskip=3mm,
%   showstringspaces=true,
%   columns=flexible,
%   basicstyle={\small\ttfamily},
%   numbers=left,
%   numberstyle=\tiny\color{red},
%   keywordstyle=\color{blue},
%   commentstyle=\color{dkgreen},
%   stringstyle=\color{mauve},
%   breaklines=true,
%   breakatwhitespace=true,
%   frame=shadowbox,
%   backgroundcolor=\color{verylightgray},
%   tabsize=3
%   }

% \lstdefinestyle{sh} {
%   language=bash,
%   aboveskip=3mm,
%   belowskip=3mm,
%   showstringspaces=true,
%   columns=flexible,
%   basicstyle={\tiny\ttfamily},
%   numbers=left,
%   numberstyle=\tiny\color{blue},
%   keywordstyle=\color{blue},
%   commentstyle=\color{dkgreen},
%   stringstyle=\color{mauve},
%   breaklines=true,
%   breakatwhitespace=true,
%   frame=shadowbox,
%   backgroundcolor=\color{lightergray},
%   tabsize=3
%   }

% \lstdefinestyle{Python} {
%   language=Python,
%   aboveskip=3mm,
%   frame=shadowbox,
%   belowskip=3mm,
%   showstringspaces=true,
%   columns=flexible,
%   basicstyle={\small\ttfamily},
%   numbers=left,
%   numberstyle=\tiny\color{red},
%   keywordstyle=\color{blue},
%   commentstyle=\color{dkgreen},
%   stringstyle=\color{mauve},
%   breaklines=true,
%   breakatwhitespace=true,
%   frame=shadowbox,
%   backgroundcolor=\color{lightgray},
%   tabsize=3}

% \lstdefinestyle{inp} {
%   language=bash,
%   aboveskip=3mm,
%   frame=shadowbox,
%   belowskip=3mm,
%   showstringspaces=true,
%   columns=flexible,
%   basicstyle={\tiny\ttfamily\scriptsize},
%   numbers=left,
%   numberstyle=\tiny\color{red},
%   keywordstyle=\color{black},
%   commentstyle=\color{dkgreen},
%   stringstyle=\color{mauve},
%   breaklines=true,
%   breakatwhitespace=true,
%   frame=shadowbox,
%   backgroundcolor=\color{lightgray},
%   tabsize=3
%   }

% \lstdefinestyle{txt} {
%   aboveskip=3mm,
%   frame=shadowbox,
%   belowskip=3mm,
%   showstringspaces=true,
%   columns=flexible,
%   basicstyle={\small\ttfamily},
%   numbers=none,
%   numberstyle=\tiny\color{red},
%   keywordstyle=\color{black},
%   commentstyle=\color{black},
%   stringstyle=\color{black},
%   breaklines=true,
%   breakatwhitespace=true,
%   frame=shadowbox,
%   backgroundcolor=\color{lightgray},
%   tabsize=3
%   }

% \DeclareCaptionFormat{listing}{\rule{\dimexpr\textwidth+17pt\relax}{0.4pt}\par\vskip1pt#1#2#3}
% \captionsetup[lstlisting]{format=listing,singlelinecheck=false, margin=0pt, font={sf},labelsep=space,labelfont=bf}

% \renewcommand\lstlistingname{Code}
% % \lstset{language=Fortran,frame=none}
% % \lstset{language=bash,frame=none}
% % \lstset{language=Python,frame=none}

% %% tikz customization
% \tikzset{state/.style={rectangle,rounded corners,draw=black, very thick,
%     minimum height=2em,inner sep=2pt,text centered}}
% \tikzset{decision/.style={diamond,aspect=2,draw=black,very thick,
%     minimum height=2em,inner sep=2pt,text centered}}
% \tikzset{process/.style={circle,draw=black,very thick,
%     minimum height=2em,inner sep=2pt,text centered}}
% \tikzset{dot/.style={circle,draw=black,thick,
%     inner sep=0pt,minimum size=4pt}}

\title{Manual for abaqusPy}
%\date{} % delete this line to display the current date

%%% BEGIN DOCUMENT

\begin{document}
\pgfplotsset{compat=1.14}


% \section{derivatives}

% \begin{eqnarray}
%   \label{eq:dbau1}
%   \frac{\partial{f_k}}{\partial{\mathbf{s}}} = \frac{\partial{f_k}}{\partial{g_k}}   \frac{\partial{g_k}}{\partial{\bar{\varepsilon}}}   \frac{\partial{\bar{\varepsilon}}}{\partial{\mathbf{\sigma}}} \frac{\partial\mathbf{\sigma}}{\partial\mathbf{s}}\\
%   \text{ where      }\ \ \  \frac{\partial{f_k}}{\partial{g_k}} = -g_k^{-q-1} f_k ^{1-q}
% \end{eqnarray}


\section{Microstructure deviator}
\label{sec:micd}


The microstructure deviator may deviate from a {\emph target} direction (i.e., $\hat{\mathbf{t}}$) when non-proportional loading condition is considered.
The degree of such deviation may be quantified by the double product $\hat{\mathbf{t}}:\hat{\mathbf{h}}$.
More accurately, this can be characterized by $\cos \chi$, which resembles the parameter introduced by Schmitt et al. \cite{schmitt1994parameter}.
\begin{equation}
  \label{eq:coschi}
\cos\chi = \frac{\hat{\mathbf{t}}:\hat{\mathbf{h}} }{ \sqrt{\hat{\mathbf{t}}:\hat{\mathbf{t}}}\sqrt{\hat{\mathbf{h}}:\hat{\mathbf{h}}}   }
\end{equation}
The target direction was originally proposed to follow the applied stress deviator $\mathbf{s}$ \cite{barlat2011alternative}.
Recently, Jeong et al. \cite{Jeong2016} demonstrated that $\hat{\mathbf{t}}=\hat{\dot{\mathbf{\varepsilon}}}$ is more physically relevant by applying a crystal plasticity model for various loading scenarios.

The evolutionary behavior of the microstructure deviator is written with respect to the equivalent strain increment such that
\begin{equation}
  \label{eq:dmicro1}
  \frac{\partial\hat{\mathbf{h}}}{\partial \bar{\varepsilon}} = k_{R1}\ \text{sgn}(\cos\chi)\big[|\frac{\cos\chi}{H}|^{1/k_{R2}} +g_R \big] \big(\hat{\mathbf{t}}-\cos\chi \hat{\mathbf{h}}\big),
\end{equation}
where $g_R$ evolves according to
\begin{equation}
  \label{eq:dmicro2}
\frac{dg_R}{d\bar{\varepsilon}} = k_{R3} \big[k_{R4} (1-\cos^2\chi) -g_R \big].
\end{equation}


\section{Derivatives of linearly transformed stresses}
\label{sec:stress_deriv}


There are a few stress tensor transformation used in HAH formalism.
In the original model of HAH, the stress tensor is decomposed into two contributions: namely, co-linear and orthogonal components with respect to the microstructure deviator.
\begin{equation}
  \label{eq:decomp1}
  \mathbf{s_c} = \frac{8}{3} (\mathbf{s}:\hat{\mathbf{h}}) \mathbf{h}
\end{equation}
The derivative of $\mathbf{s_c}$ with respect to $\mathbf{s}$ is
\begin{eqnarray}
  \begin{split}
  \label{eq:decomp2}
  \frac{\partial\mathbf{s_c}}{\partial\mathbf{s}}&= \frac{8}{3}\bigg\{  \frac{\partial(\mathbf{s}:\hat{\mathbf{h}})}{\partial\mathbf{s}} \otimes \hat{\mathbf{h}}\bigg\} \\
  \bigg( \frac{\partial s_c}{\partial s}\bigg)_{ij,kl} &= \frac{8}{3}\Bigg\{ \bigg(\frac{\partial(s_{mn}\hat{h}_{mn})}{\partial s}\bigg)_{ij}\hat{h}_{kl} \Bigg\}=\frac{8}{3}\Bigg\{\frac{1}{2}(\delta_{mi}\delta_{nj}+\delta_{mj}\delta_{ni})\hat{h}_{mn}\hat{h}_{kl} \Bigg\}\\
  &=\frac{8}{3}\Bigg\{\frac{1}{2}(\hat{h}_{ij}+\hat{h}_{ji})\hat{h}_{kl} \Bigg\}.
  \end{split}
\end{eqnarray}

The orthogonal component is defined as:
\begin{eqnarray}
  \label{eq:decomp3}
  \mathbf{s_o} = \mathbf{s} - \mathbf{s}_c.
\end{eqnarray}
The derivative is then
\begin{eqnarray}
  \label{eq:decomp4}
  \begin{split}
    \frac{\partial\mathbf{s_o}}{\partial\mathbf{s}} &= \mathbf{I} -   \frac{\partial\mathbf{s_c}}{\partial\mathbf{s}}\\
    \bigg(\frac{\partial s_o}{\partial s}\bigg)_{ij,kl} &= \frac{1}{2}(\delta_{ik}\delta_{jl}+\delta_{il}\delta_{jk})- \bigg(\frac{\partial s_c}{\partial s}\bigg)_{ij,kl}
  \end{split}
\end{eqnarray}


The latent hardening is accounted for by using a linear-transformation of the deviatoric stress tensor into
\begin{eqnarray}
  \label{eq:latent_decompose1}
  \mathbf{s}^{\prime\prime}=\mathbf{s}_c+\frac{1}{g_L}\mathbf{s}_o
\end{eqnarray}
Its derivative is obtained as
\begin{eqnarray}
  \begin{split}
    \label{eq:latent_decompose2}
    \frac{\partial\mathbf{s}^{\prime\prime}}{\partial\mathbf{s}} &=\frac{\partial\mathbf{s}_c}{\partial\mathbf{s}} + g_L^{-1} \frac{\partial\mathbf{s}_o}{\partial\mathbf{s}}.
  \end{split}
\end{eqnarray}


The stress used for cross hardening goes through below transformation.
\begin{eqnarray}
  \label{eq:cross_linear1}
  \mathbf{s}_p = 4(1-g_s)\mathbf{s}_o
\end{eqnarray}
Its derivative with respect to the deviatoric stress can be obtained as:
\begin{eqnarray}
  \begin{split}
    \label{eq:cross_linear2}
    \frac{\partial\mathbf{s}_p}{\partial\mathbf{s}}                 &= 4(1-g_s) \frac{\partial\mathbf{s}_o}{\partial\mathbf{s}} \\
    \bigg(\frac{\partial s_p}{\partial s} \bigg)_{ij,kl} &=  4(1-g_s) \bigg(\frac{\partial s_o}{\partial s}\bigg)_{ij,kl}
  \end{split}
\end{eqnarray}


\newpage
\section{Derivatives associated with Bauschinger effect}
\label{sec:bauschinger}


The term $\partial f_k/\partial\mathbf{\sigma}$ depends on the evolutionary behavior of $f_k$ with respect to equivalent strain $\bar{\varepsilon}$.
This allows the application of the chain rule such as
\begin{eqnarray}
  \label{eq:dphib7}
  \frac{\partial f_k}{\partial\mathbf{\sigma}}=\frac{\partial f_k}{\partial g_k} \frac{\partial g_k}{\partial \bar{\varepsilon}}  \frac{\partial{\bar{\varepsilon}}}{\partial\mathbf{\sigma}}.
\end{eqnarray}

\begin{eqnarray}
  \label{eq:fk1}
  f_k = \bigg[ \frac{\sqrt{6H}}{4}   \Big(  g_k^{-q} - 1  \Big)  \bigg] ^{1/q}
\end{eqnarray}


\begin{eqnarray}
  \label{eq:fk2}
  \begin{split}
  \frac{\partial f_k}{\partial{g_k}} &= \frac{1}{q}   \bigg(\frac{\sqrt{6H}}{4} \bigg)^{1/q}  (-q) g_k^{-q-1}    f_k^{1-q}\\
  &=-g_k^{-q-1} f_k^{1-q}  \ \text{  if } H=8/3
  \end{split}
\end{eqnarray}

The term $  \partial{g_k}/\partial{\bar{\varepsilon}} $ depends on the sign of $\hat{\mathbf{h}}:\mathbf{s}$.
For the case of $g_1$ and when  $\hat{\mathbf{h}}:\mathbf{s}<0$:
\begin{eqnarray}
  \label{eq:dbau2}
\frac{\partial{g_1}}{\partial{\bar{\varepsilon}}}=k_1 \frac{g_4-g_1}{g_1}
\end{eqnarray}
whereas, if $\hat{\mathbf{h}}:\mathbf{s}\ge0$,
\begin{eqnarray}
  \label{eq:dbau3}
\frac{\partial{g_1}}{\partial{\bar{\varepsilon}}}=k_2 (k_3 H(0)/H(\bar{\varepsilon})-g_1)
\end{eqnarray}


$g_2$ follows a similar rule as follows:
when  $\hat{\mathbf{h}}:\mathbf{s}<0$:
\begin{eqnarray}
  \label{eq:dbau4}
  \frac{\partial{g_2}}{\partial{\bar{\varepsilon}}}=k_2 (k_3 H(0)/H(\bar{\varepsilon})-g_2)
\end{eqnarray}
whereas, if $\hat{\mathbf{h}}:\mathbf{s}\ge0$,
\begin{eqnarray}
  \label{eq:dbau5}
  \frac{\partial{g_2}}{\partial{\bar{\varepsilon}}}=k_1 \frac{g_3-g_2}{g_2}
\end{eqnarray}

With explicit indices, the above is expressed as:
\begin{equation}
  \label{eq:dphib8}
  \bigg(\frac{\partial f_k}{\partial \sigma}\bigg)_{ij} = \frac{\partial f_k}{\partial g_k} \frac{\partial g_k}{\partial \bar{\varepsilon}}  \bigg(\frac{\partial\bar{\varepsilon}}{\partial\sigma}\bigg)_{kl}.
\end{equation}


\newpage
\section{Yield surface derivative}


The yield surface of HAH model is decomposed into two contributions: the homogeneous and fluctuating terms that are $\phi_h$ and $\phi_b$.
\begin{eqnarray}
  \label{eq:hah_def}
  \Phi(\mathbf{\sigma})=\{\phi_h^q + \phi_b^q \}^{1/q}=\bar{\sigma}
\end{eqnarray}

The homogeneous term is further decomposed into two contributions:
\begin{eqnarray}
  \label{eq:hah_homo}
  \phi_h = \big(\psi(\mathbf{s}^{\prime\prime})^2+\psi(\mathbf{s_p})^2\big)^{1/2}
\end{eqnarray}

Whereas, the fluctuating term is defined as:
\begin{eqnarray}
    \label{eq:fluc}
\phi_b  = f_1|\hat{\mathbf{h}}:\mathbf{s} - |\hat{\mathbf{h}}:\mathbf{s}||    + f_2|\hat{\mathbf{h}}:\mathbf{s} + |\hat{\mathbf{h}}:\mathbf{s}||.
\end{eqnarray}

The derivative of the HAH yield surface is:
\begin{eqnarray}
  \begin{split}
  \label{eq:hah_deriv}
  \frac{\partial\Phi}{\partial\mathbf{\sigma}} &=\frac{1}{q}\Phi^{(1-q)} \bigg\{                  \frac{\partial{\phi_h^q}}{\partial{\sigma}}  +                 \frac{\partial{\phi_b^q}}{\partial{\sigma}}         \bigg\}\\
  \bigg(\frac{\partial\Phi}{\partial\sigma}\bigg)_{ij}&=\frac{1}{q}\Phi^{(1-q)} \bigg\{  q \phi_h^{(q-1)}\Big(\frac{\partial{\phi_h}  }{\partial{\sigma}}\Big)_{ij}  + q \phi_b^{(q-1)} \Big(\frac{\partial{\phi_b}  }{ \partial\sigma}\Big)_{ij}         \bigg\}
  \end{split}
\end{eqnarray}

The terms $\frac{\partial{\phi_h}  }{\partial{\mathbf{\sigma}}}$ and $\frac{\partial{\phi_b}  }{\partial{\mathbf{\sigma}}}$ are obtained in the following sections.


\subsection{Derivatives of homogeneous term}
\label{sec:2.1}


The derivative of the homogeneous term is obtained using the chain rule as follows:
\begin{eqnarray}
  \label{eq:derv1}
  \frac{\partial{\phi_h}  }{\partial{\mathbf{\sigma}}}  =   \frac{\partial{\phi_h}}{\partial{\mathbf{s}}} \frac{\partial{\mathbf{s}}}{\partial{\mathbf{\sigma}}}.
\end{eqnarray}

The term $\partial\phi_h/\partial \mathbf{s} $ is obtained using Eq. \ref{eq:hah_homo}:
\begin{eqnarray}
  \label{eq:derv2}
  \frac{\partial{\phi_h}  }{\partial{\mathbf{s}}} = \frac{1}{2\phi_h}\bigg\{ 2\psi(\mathbf{s}^{\prime\prime})\frac{\partial{\psi(\mathbf{s}^{\prime\prime})}}{\partial{\mathbf{s}^{\prime\prime}}}  \frac{\partial\mathbf{s}^{\prime\prime}}{\partial \mathbf{s}}  +  2\psi(\mathbf{s}_p) \frac{\partial{\psi(\mathbf{s}_p)}}{\partial{\mathbf{s}_p}} \frac{\partial{\mathbf{s}_p}}{\partial{\mathbf{s}}}\bigg\}
\end{eqnarray}

By combining Eqs. \ref{eq:derv1} and \ref{eq:derv2}, below equation is obtained:
\begin{eqnarray}
  \label{eq:derv3}
  \begin{split}
  \frac{\partial{\phi_h}}{\partial{\mathbf{\sigma}}} &=\frac{1}{2\phi_h}\bigg\{ 2\psi(\mathbf{s}^{\prime\prime})\frac{\partial{\psi(\mathbf{s}^{\prime\prime})}}{\partial{\mathbf{s}^{\prime\prime}}}  \frac{\partial\mathbf{s}^{\prime\prime}}{\partial \mathbf{s}} + 2\psi(\mathbf{s}_p) \frac{\partial{\psi(\mathbf{s}_p)}}{\partial{\mathbf{s}_p}} \frac{\partial{\mathbf{s}_p}}{\partial{\mathbf{s}}}\bigg\} \frac{\partial{s}}{\partial{\sigma}}.\\
  \Big(\frac{\partial{\phi_h}}{\partial\sigma}\Big)_{ij} &= \frac{1}{\phi_h}\bigg\{ \psi(s^{\prime\prime})\Big(\frac{\partial{\psi(s^{\prime\prime})}}{\partial{s^{\prime\prime}}}\Big)_{kl}  \Big(\frac{\partial s^{\prime\prime}}{\partial s}\Big)_{kl,mn} + \\
    & \psi(s_p) \Big(\frac{\partial{\psi(s_p)}}{\partial{s_p}}\Big)_{kl} \Big(\frac{\partial{s_p}}{\partial s}\Big)_{kl,mn}\bigg\} \Big(\frac{\partial s}{\partial \sigma}\Big)_{mn,ij}
  \end{split}
\end{eqnarray}


\subsection{Derivatives of fluctuating term $\partial\phi_b/\partial\mathbf{\sigma}$}
\label{sec:2.2}



The term $\phi_b$ depends on the sign of $\hat{\mathbf{h}}:\mathbf{s}$ as shown in Eq. \ref{eq:fluc}.
When $\hat{\mathbf{h}}:\mathbf{s}\ge0$, Eq. \ref{eq:fluc} reduces to
\begin{eqnarray}
    \label{eq:fluc1}
\phi_b =f_2|2\hat{\mathbf{h}}:\mathbf{s}|=f_2|2\hat{h}_{ij}:s_{ij}|
\end{eqnarray}


When $\hat{\mathbf{h}}:\mathbf{s}<0$, Eq. \ref{eq:fluc} reduces to
\begin{eqnarray}
    \label{eq:fluc2}
\phi_b  =f_1|2\hat{\mathbf{h}}:\mathbf{s}|=f_1|2\hat{h}_{ij}:s_{ij}|.
\end{eqnarray}

Generally,
\begin{eqnarray}
    \label{eq:fluc3}
\phi_b  =f_k|2\hat{\mathbf{h}}:\mathbf{s}|=f_k|2\hat{h}_{ij}:s_{ij}|,
\end{eqnarray}
with the index $k$ being dependent on the sign of $\hat{\mathbf{h}}:\mathbf{s}$.
The derivative $\partial\phi_b/\partial\mathbf{s}$ can be expressed as:
\begin{eqnarray}
    \label{eq:dphib1}
    \frac{\partial\phi_b}{\partial\mathbf{\sigma}} = 2\frac{\partial f_k}{\partial\mathbf{\sigma}}|\hat{\mathbf{h}}:\mathbf{s}| + 2 f_k \frac{\partial|\hat{\mathbf{h}}:\mathbf{s}|}{\partial\mathbf{\sigma}}
\end{eqnarray}

The term $\partial|\hat{\mathbf{h}}:\mathbf{s}|/\partial\mathbf{\sigma}$ takes on either the below depending on the sign of $\hat{\mathbf{h}}:\mathbf{s}$.
\begin{eqnarray}
  \label{eq:dphib2}
  \frac{\partial |\hat{\mathbf{h}}:\mathbf{s}| }{\partial \mathbf{\sigma}} &=&  \frac{\partial \big(\hat{\mathbf{h}}:\mathbf{s}\big)}{\partial\mathbf{\sigma}}   \text{  when } \hat{\mathbf{h}}:\mathbf{s}\ge0\\
  \label{eq:dphib2_}
&=&- \frac{\partial \big(\hat{\mathbf{h}}:\mathbf{s}\big)}{\partial\mathbf{\sigma}}   \text{  when } \hat{\mathbf{h}}:\mathbf{s} < 0
\end{eqnarray}

Substituting Eqs. \ref{eq:dphib2} and \ref{eq:dphib2_} to \ref{eq:dphib1} gives
\begin{equation}
  \label{eq:dphib1_}
  \begin{split}
    \frac{\partial\phi_b}{\partial\mathbf{\sigma}}          &= 2\ \text{sgn}(\hat{\mathbf{h}}:\mathbf{s}) \bigg[  \frac{\partial{f_k}}{\partial{\mathbf{\sigma}}} (\hat{\mathbf{h}}:\mathbf{s}) + f_k \frac{\partial\big({\hat{\mathbf{h}}:\mathbf{s}}\big)}{\partial{\mathbf{\sigma}}} \bigg]\\
    \bigg(\frac{\partial\phi_b}{\partial \sigma}\bigg)_{ij} &= 2\ \text{sgn}(\hat{h}_{mn}s_{mn}) \bigg[  \bigg(\frac{\partial f_k}{\partial \sigma}\bigg)_{ij} (\hat{h}_{mn}s_{mn}) + f_k \bigg(\frac{\partial\big({\hat{h}_{mn}s_{mn}}\big)}{\partial \sigma}\bigg)_{ij} \bigg]\\
  \end{split}
\end{equation}


\subsubsection{$\partial\big(\hat{\mathbf{h}}:\mathbf{s}\big)/ \partial\mathbf{\sigma}$ }
\label{sec:3.2.1}


The derivative  $\partial\big(\hat{\mathbf{h}}:\mathbf{s}\big)/ \partial\mathbf{\sigma}$ is obtained as:
\begin{equation}
  \begin{split}
    \label{eq:dphib3}
    \frac{\partial \big(\hat{\mathbf{h}}:\mathbf{s} \big)  } {\partial\mathbf{\sigma}} &= \frac{\partial \hat{\mathbf{h}}}{\partial\mathbf{\sigma}} : \mathbf{s} +\hat{\mathbf{h}}:\frac{\partial \mathbf{s}}{\partial\mathbf{\sigma}}\\
    \bigg(\frac{\partial \big(\hat{h}:s \big)  } {\partial \sigma}\bigg)_{ij} &= \bigg(\frac{\partial\hat{h}}{\partial \sigma}\bigg)_{ij,kl} s_{kl} +\hat{h}_{kl}\frac{\partial s}{\partial\sigma}_{kl,ij}
  \end{split}
\end{equation}

The term $ \partial\hat{\mathbf{h}}/ \partial\mathbf{\sigma} $ can be obtained through:
\begin{equation}
  \label{eq:dphib4}
\frac{\partial\hat{\mathbf{h}}}{\partial\mathbf{\sigma}}=\frac{\partial{\hat{\mathbf{h}}}}{\partial{\bar{\varepsilon}}}   \frac{\partial{\bar{\varepsilon}}}{\partial{\mathbf{\sigma}}}
\end{equation}

$\partial\hat{\mathbf{h}}/\partial\bar{\varepsilon} $ can be obtained using the evolutionary rule of $\hat{\mathbf{h}}$.
Note that $\partial\bar{\mathbf{\varepsilon}}/\partial\mathbf{\sigma}$ can be obtained using the normality rule:
\begin{equation}
  \label{eq:dphib5}
  \frac{\partial{\mathbf{\sigma}}}{\partial{\bar{\varepsilon}}} = - \mathbb{C}^{el} : \frac{\partial\Phi}{\partial{\mathbf{\sigma}}} = -\mathbb{C}^{el}_{ij,kl} \bigg(\frac{\partial\Phi}{\partial\sigma}\bigg)_{kl}
\end{equation}
which leads to
\begin{equation}
  \label{eq:dphib6}
  \begin{split}
      \frac{\partial\hat{\mathbf{h}}}{\partial\mathbf{\sigma}} &=\frac{\partial\hat{\mathbf{h}}}{\partial\bar{\varepsilon}}\otimes \bigg\{ \Big\{- \mathbb{C}^{el} : \frac{\partial\Phi}{\partial\mathbf{\sigma}}\Big\}^{-1} \bigg\}\\
    \bigg(\frac{\partial\hat{h}}{\partial \sigma}\bigg)_{ij,l}&=\bigg(\frac{\partial\hat{h}}{\partial\bar{\varepsilon}}\bigg)_{ij} \bigg\{- \mathbb{C}^{el}_{kl,mn} \Big(\frac{\partial\Phi}{\partial\sigma}\Big)_{mn}\bigg\}^{-1}
  \end{split}
\end{equation}
Substitute Eq. \ref{eq:dphib6} to Eq. \ref{eq:dphib3} to have
\begin{equation}
  \label{eq:dphib6_1}
  \begin{split}
    \frac{\partial \big(\hat{\mathbf{h}}:\mathbf{s}\big)  }{\partial\mathbf{\sigma}}&=\frac{\partial{\hat{\mathbf{h}}}}{\partial{\bar{\varepsilon}}} \bigg\{ \Big\{- \mathbb{C}^{el} : \frac{\partial \Phi}{\partial{\mathbf{\sigma}}}\Big\}^{-1}:\mathbf{s}\bigg\} + \hat{\mathbf{h}}:\frac{\partial\mathbf{s}}{\partial\mathbf{\sigma}}\\
    \bigg(\frac{\partial \big(\hat{h}:s\big)}{\partial \sigma}\bigg)_{ij} & = \bigg(\frac{\partial\hat{h}}{\partial\bar{\varepsilon}}\bigg)_{ij} \bigg\{\bigg(\frac{\partial\bar{\varepsilon}}{\partial\sigma}\bigg)_{mn} s_{mn}\bigg\} + \hat{h}_{mn}\bigg(\frac{\partial s}{\partial \sigma}\bigg)_{mn,ij},
  \end{split}
\end{equation}
where $\partial \hat{\mathbf{h}}/ \partial\bar{\varepsilon}$ is given in Eq. \ref{eq:dmicro1}.


\subsubsection{Calculation procedure on $\big(\partial\phi_b/\partial \sigma\big)_{ij}$}
\label{sec:calc}


Substitution of Eqs. \ref{eq:dphib8} and \ref{eq:dphib6_1} into Eq. \ref{eq:dphib1_} gives below:

\begin{equation}
  \label{eq:dphib_main}
  \begin{split}
    \bigg(\frac{\partial\phi_b}{\partial \sigma}\bigg)_{ij} &= 2\ \text{sgn}(\hat{h}_{mn}s_{mn}) \bigg[(\hat{h}_{mn}s_{mn})
    \frac{\partial f_k}{\partial g_k} \frac{\partial g_k}{\partial \bar{\varepsilon}}
    \bigg(\frac{\partial\bar{\varepsilon}}{\partial\sigma}\bigg)_{kl}
   \\
    &+ f_k\bigg\{
    \bigg(\frac{\partial\hat{h}}{\partial\bar{\varepsilon}}\bigg)_{ij} \bigg\{\bigg(\frac{\partial\bar{\varepsilon}}{\partial\sigma}\bigg)_{mn} s_{mn}\bigg\} + \hat{h}_{kl} \bigg(\frac{\partial s}{\partial \sigma}\bigg)_{kl,ij}
      \bigg\}
    \bigg]
  \end{split}
\end{equation}

Note that the above equation is an implicit function of $\partial\Phi/\partial\sigma\ $(i.e., $\partial\Phi/\partial \sigma$) through $\partial\bar{\varepsilon}/\partial\sigma$ as shown in Eq. \ref{eq:dphib5}.



\newpage
\section{Calculation procedure}
\label{sec:prc}
\begin{enumerate}[1)]
\item We start to calculate $\cos\chi$ and $\partial \hat{\mathbf{h}}/\partial \bar{\varepsilon}$ using Eqs. \ref{eq:coschi} and \ref{eq:dmicro1}, respectively.
\item Use $\partial \hat{\mathbf{h}}/\partial \bar{\varepsilon}$ to obtain $\partial \hat{\mathbf{h}}/\partial \mathbf{\sigma}$ in Eq. \ref{eq:dphib6}. This also requires $\mathbb{C}^{el}$ and $\partial\Phi/\partial\mathbf{\sigma}$.
\item Obtain $\partial\big(\hat{\mathbf{h}}:\mathbf{s}\big)/\partial \mathbf{\sigma}$ in Eq. \ref{eq:dphib3}
\item Also, obtain $\partial \mathbf{s_c}/\partial \mathbf{s}$ and $\partial \mathbf{s_o}/\partial\mathbf{s}$ in Eqs. \ref{eq:decomp2} and \ref{eq:decomp4}, respectively.
\item Obtain $\partial \mathbf{s_p}/\partial\mathbf{s}$ using Eq. \ref{eq:cross_linear2}.
\item Obtain $\partial\mathbf{s}^{\prime\prime}/\partial\mathbf{s}$ using $\partial \mathbf{s_c}/\partial \mathbf{s}$.
\item Plug $\partial\mathbf{s}^{\prime\prime}/\partial\mathbf{s}$ and  $\partial \mathbf{s_p}/\partial\mathbf{s}$ into Eq. \ref{eq:derv3} to obtain $\partial\phi_h/\partial\mathbf{\sigma}$.
\item Obtain $\partial f_k/\partial \mathbf{\sigma}$ in Eq. \ref{eq:dphib8}.
\item Calculate $\partial \phi_b/\partial \mathbf{\sigma}$ in Eq. \ref{eq:dphib1_}
\item Plug $\partial \phi_b/\partial\mathbf{\sigma}$ and $\partial\phi_h/\partial\mathbf{\sigma}$ into Eq. \ref{eq:hah_deriv}.
% \item Note that both $\partial \phi_b/\partial\mathbf{\sigma}$ and $\partial\phi_h/\partial\mathbf{\sigma}$ are dependent on $\partial\Phi/\partial\mathbf{\sigma}.$
\end{enumerate}





\newpage
\bibliography{bib}
\bibliographystyle{ieeetr}

\end{document}



%\bibliographystyle{ieeetr}
